{% extends 'base.html' %}
{% block title %}
Terms of Service & Setup - FightHealthInsurance Chat Assistant (Alpha)
{% endblock title %}

{% load static %}

{% block scriptmagic %}
<script src="{% static 'js/dist/user_info_storage.bundle.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (window.userInfoStorage) {
      window.userInfoStorage.setupFormPersistence('user_consent_form');
    }
  });
</script>
{% endblock scriptmagic %}

{% block content %}
<section class="mt-2">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Terms of Service & Your Information</h2>
          </div>
          <div class="card-body">
            {% if form.errors %}
            <div class="alert alert-danger">
              {{ form.errors }}
            </div>
            {% endif %}

            <p class="mb-4">
              Before you start chatting with the FightHealthInsurance Assistant, please review and accept our terms of service and provide some basic information. This information will be used to protect your privacy by replacing personal details in your messages.
            </p>

            <form method="post" id="user_consent_form">
              {% csrf_token %}
              
              <!-- Hidden fields to preserve microsite parameters -->
              {% if default_procedure %}
              <input type="hidden" name="default_procedure" value="{{ default_procedure }}">
              {% endif %}
              {% if default_condition %}
              <input type="hidden" name="default_condition" value="{{ default_condition }}">
              {% endif %}
              {% if microsite_slug %}
              <input type="hidden" name="microsite_slug" value="{{ microsite_slug }}">
              {% endif %}
              {% if microsite_title %}
              <input type="hidden" name="microsite_title" value="{{ microsite_title }}">
              {% endif %}
              {% if denial_text %}
              <textarea name="denial_text" style="display:none;">{{ denial_text }}</textarea>
              {% endif %}

              {% include 'partials/user_consent_form_fields.html' %}

              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">Continue to Chat</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock content %}
