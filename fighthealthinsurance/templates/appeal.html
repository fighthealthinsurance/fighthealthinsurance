{% extends 'base.html' %}
{% load static %}
{% block scriptmagic %}
<script type="module">
  import * as main from '{% static "js/dist/appeal.bundle.js" %}';
</script>
<script src="{% static 'js/pwyw.js' %}"></script>
{% endblock scriptmagic %}
{% block title %}
Fight Your Health Insurance Denial: Edit and send in your appeal
{% endblock title %}

{% block content %}
<div class="container" style="padding-top:1rem;">
  <!-- Progress indicator -->
  {% include 'partials/flow_progress.html' with current_step=current_step|default:8 %}
</div>

<div style="background:#e8f5e9; padding:1.5rem; border-radius:8px; margin:1.5rem 0; border-left:4px solid #4caf50;">
  <h3 style="margin:0 0 0.5rem 0; color:#2e7d32;">Your Appeal is Ready!</h3>
  <p style="margin:0;">Review the draft below, make any edits you need, then send it to your insurance company.</p>
</div>

<div class="appeal-donate-wrapper" style="background-color: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
  <p style="color: #333; margin-bottom: 1rem;">
    <strong>Help us help others:</strong> Fight Health Insurance is a free service. If we've helped you, consider supporting our work:
    <a href="https://buy.stripe.com/5kA03r2ZwbgebyE7ss" class="section-btn btn btn-default smoothScroll" id="support-our-dev-button" target="_blank" rel="noopener noreferrer">
      Pay What You Want (optional)
    </a>
  </p>
  {% include 'partials/pwyw_panel.html' %}
</div>

<h4>Edit Your Appeal</h4>
<p>Review and customize the appeal below. You can add personal details, correct any errors, or adjust the tone.</p>

<form action="{% url 'share_appeal' %}" method="post" class="col-md-12 d-flex flex-column align-items-center">
  {% csrf_token %}
  <input type="hidden" name="email" value="{{ user_email }}">
  <input type="hidden" name="denial_id" value="{{ denial_id }}">
  
  <textarea class="appeal_text" name="appeal_text" id="scrubbed_appeal_text">
    {{appeal}}
  </textarea>

  <!-- <button type="submit" class="btn btn-green">(Optional) Upload and Share (do not include PII)</button> -->
</form>
<button id="descrub" class="btn btn-green">
  Fill in your PII
</button>


<p>
  Once your satisified it's time to send in your appeal! Your denial should include the mailing address or fax number to submit your appeal to.
</p>
<p>
  {{appeal_info_extracted}}
</p>
<p>
  We can try and send the fax for you for a small fee if you want, but know you can send it in other ways.
</p>
<p>
  Note: Faxing your appeal with us does temporarily store the full filled in appeal on our servers (and potentially fax partners). Your e-mail will also be stored temporarily.
</p>
<!-- Put this back once we write that java script. -->
<form action="{% url 'stagefaxview' %}" method="post" class="col-md-12 d-flex flex-column align-items-center">
  {% csrf_token %}
  {{fax_form}}
  <div class="fax-pwyw-group" aria-label="Fax price (optional, pay what you want)">
    <label><input type="radio" name="fax_pwyw" value="0" checked>$0 <small>Need it free</small></label>
    <label><input type="radio" name="fax_pwyw" value="5">$5 <small>Original price</small></label>
    <label><input type="radio" name="fax_pwyw" value="10">$10 <small>Keep lights on</small></label>
    <label><input type="radio" name="fax_pwyw" value="custom">Custom
      <input type="number" min="1" max="1000" step="1" class="fax-custom-input" name="fax_amount_custom" placeholder="Amount" aria-label="Custom fax amount">
    </label>
  </div>
  <input type="hidden" name="fax_amount" value="0">
  <button id="fax_appeal" class="btn-green">
    Fax Appeal (Pay what you want)
  </button>
</form>
<!--
<button id="generate_pdf">
  Generate PDF (limited to 1 page)
</button>
-->
<br>
or:
<button id="print_appeal">
  Print Appeal (self submit)
</button>
<p>
  Appreciate us? You can:
  <a href="https://buy.stripe.com/5kA03r2ZwbgebyE7ss" class="section-btn btn btn-default smoothScroll" id="support-our-dev-button" target="_blank" rel="noopener noreferrer">
    Pay What You Want / Support our Development (optional)
  </a>
</p>
{% include 'partials/pwyw_panel.html' %}

<div class="appeal-share-wrapper">
  {% include 'partials/share_buttons.html' %}
</div>
<p>
* We'll do our best to include a summary or abstract if available from PubMed.
</p>
{% endblock content %}
