# Insurance Company & Plan Model Relationships

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  InsuranceCompany       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                 â”‚
â”‚ name (unique)           â”‚
â”‚ alt_names               â”‚
â”‚ regex                   â”‚
â”‚ negative_regex          â”‚
â”‚ website                 â”‚
â”‚ notes                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 1:N
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  InsurancePlan          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                 â”‚
â”‚ insurance_company (FK)  â”‚â”€â”€â”€â”
â”‚ plan_name               â”‚   â”‚ References
â”‚ state                   â”‚   â”‚ InsuranceCompany
â”‚ plan_type (FK)          â”‚â—„â”€â”€â”˜
â”‚ plan_source (FK)        â”‚
â”‚ regex                   â”‚
â”‚ negative_regex          â”‚
â”‚ plan_id_prefix          â”‚
â”‚ notes                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Optional N:1
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Denial                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ denial_id (PK)          â”‚
â”‚ ...                     â”‚
â”‚ insurance_company       â”‚  â† Text field (backward compatible)
â”‚ insurance_company_obj   â”‚  â† FK to InsuranceCompany (new)
â”‚ insurance_plan_obj      â”‚  â† FK to InsurancePlan (new)
â”‚ ...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Example Data Structure

### Insurance Company: Anthem
```
InsuranceCompany
â”œâ”€ name: "Anthem Blue Cross Blue Shield"
â”œâ”€ alt_names: "Anthem\nBCBS\nBlue Cross Blue Shield"
â””â”€ plans:
    â”œâ”€ InsurancePlan (CA Medicaid)
    â”‚   â”œâ”€ plan_name: "Medicaid"
    â”‚   â”œâ”€ state: "CA"
    â”‚   â””â”€ plan_source: Medicaid (FK)
    â”‚
    â”œâ”€ InsurancePlan (NY Medicaid)
    â”‚   â”œâ”€ plan_name: "Medicaid"
    â”‚   â”œâ”€ state: "NY"
    â”‚   â””â”€ plan_source: Medicaid (FK)
    â”‚
    â””â”€ InsurancePlan (Medicare Advantage)
        â”œâ”€ plan_name: "Medicare Advantage"
        â”œâ”€ state: "" (national)
        â””â”€ plan_source: Medicare Advantage (FK)
```

## Extraction Flow

```
User submits denial
        â”‚
        â–¼
Denial created with text
        â”‚
        â–¼
Async extraction starts
        â”‚
        â”œâ”€â–º ML extracts company name
        â”‚   (e.g., "Anthem BCBS")
        â”‚           â”‚
        â”‚           â–¼
        â”‚   Match to InsuranceCompany
        â”‚   (fuzzy match: "Anthem Blue Cross Blue Shield")
        â”‚           â”‚
        â”‚           â–¼
        â”‚   Set Denial.insurance_company_obj
        â”‚
        â”œâ”€â–º Regex match InsurancePlan
        â”‚   (check denial text against plan regex patterns)
        â”‚           â”‚
        â”‚           â–¼
        â”‚   Found: "Anthem Medicaid California"
        â”‚           â”‚
        â”‚           â–¼
        â”‚   Set Denial.insurance_plan_obj
        â”‚
        â””â”€â–º Set text fields for backward compatibility
```

## User Interface

### Form Fields (BasePostInferedForm)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Insurance company (text)                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Anthem                                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ Select insurance company (optional)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [Select...]                              â–¼ â”‚ â”‚
â”‚ â”‚  - Anthem Blue Cross Blue Shield            â”‚ â”‚
â”‚ â”‚  - UnitedHealthcare                         â”‚ â”‚
â”‚ â”‚  - Aetna                                    â”‚ â”‚
â”‚ â”‚  - ...                                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ Select specific plan (optional)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [Select...]                              â–¼ â”‚ â”‚
â”‚ â”‚  - Anthem - Medicaid (CA)                   â”‚ â”‚
â”‚ â”‚  - Anthem - Medicaid (NY)                   â”‚ â”‚
â”‚ â”‚  - Anthem - Medicare Advantage              â”‚ â”‚
â”‚ â”‚  - ...                                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Admin Interface

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Django Admin - Insurance Companies               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ Search: [________________] ğŸ”                   â”‚
â”‚                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ID  â”‚ Name         â”‚ Website             â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1   â”‚ Anthem BCBS  â”‚ anthem.com          â”‚   â”‚
â”‚ â”‚ 2   â”‚ UnitedHealth â”‚ uhc.com             â”‚   â”‚
â”‚ â”‚ 3   â”‚ Aetna        â”‚ aetna.com           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Django Admin - Insurance Plans                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ Filter by:                                       â”‚
â”‚   Company: [All]     State: [All]                â”‚
â”‚   Type: [All]        Source: [All]               â”‚
â”‚                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ID  â”‚ Company   â”‚ Plan   â”‚ State â”‚ Type â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚ 1   â”‚ Anthem    â”‚ Medic. â”‚ CA    â”‚ Med. â”‚    â”‚
â”‚ â”‚ 2   â”‚ Anthem    â”‚ Medic. â”‚ NY    â”‚ Med. â”‚    â”‚
â”‚ â”‚ 3   â”‚ United... â”‚ Medic. â”‚ CA    â”‚ Med. â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Benefits

1. **State-Specific Tracking** 
   - Distinguish Anthem CA vs NY Medicaid
   - Analyze denial patterns by state
   
2. **Structured Data**
   - Query denials by company
   - Generate company-specific reports
   - Track plan performance
   
3. **Automatic Matching**
   - ML extracts company name
   - Regex matches specific plans
   - Links structured data automatically
   
4. **Backward Compatible**
   - Text fields still work
   - Optional structured fields
   - Gradual data migration
